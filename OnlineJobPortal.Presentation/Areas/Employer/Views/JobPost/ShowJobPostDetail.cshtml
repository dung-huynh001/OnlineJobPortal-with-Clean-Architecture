@using OnlineJobPortal.Domain.Entities
@model JobPost?
<link rel="stylesheet" href="~/css/JobDetailPage/jobdetail.css">
<style>
    .section a {
        color: #333
    }

    .section a.active {
        color: #5b99ea;
        border-bottom: 3px solid #5b99ea;
    }

    .list-group .list-group-item div .fa-caret-right {
        rotate: 0deg;
        transition: transform 0.5s ease;
    }

    .list-group .list-group-item.active div .fa-caret-right {
        transform: rotate(90deg);
    }
</style>

<div class="row g-3">
    <div class="col-12 bg-white rounded-3">
        <div class="d-flex p-3 justify-content-between border-bottom">
            <div class="d-flex flex-column">
                <h5>@Model?.Title</h5>
                <div>@Model?.EmploymentType.ToString()</div>
                <div>@Model?.Address</div>
            </div>
            <div>
                Đang có <span class="text-primary fw-bold">@Model?.Applications?.Count</span> ứng viên
            </div>
        </div>
        <div class="d-flex justify-content-around section" role="tablist">
            <a role="button" class="py-3 mb-1 flex-grow-1 text-center active btn-change-section" id="applicant-section"
                data-bs-toggle="tab" data-bs-target="#applicant-section-content" type="button" role="tab"
                aria-controls="applicant-section-content" aria-selected="true">Ứng viên</a>
            <a role="button" class="py-3 mb-1 flex-grow-1 text-center btn-change-section" id="job-post-section"
                data-bs-toggle="tab" data-bs-target="#job-post-section-content" type="button" role="tab"
                aria-controls="job-post-section-content" aria-selected="false">Chi tiết
                tuyển dụng</a>
        </div>
    </div>
    <div class="col-12 bg-white rounded-3 tab-content">
        <div class="tab-pane fade show active" id="applicant-section-content" role="tabpanel"
            aria-labelledby="applicant-section">
            <div class="d-flex flex-column p-3 ">
                <div class="d-flex align-items-center border-bottom py-3">
                    <div class="m-0 p-0 d-flex gap-3" role="tablist">
                        <a class="btn btn-outline-info active" id="applicant-tab" data-bs-toggle="tab"
                            data-bs-target="#applicant-tab-content" type="button" role="tab"
                            aria-controls="applicant-tab-content" aria-selected="true">Tất cả ứng viên</a>
                        <a class="btn btn-outline-info" id="suggest-tab" data-bs-toggle="tab"
                            data-bs-target="#suggest-tab-content" type="button" role="tab"
                            aria-controls="suggest-tab-content" aria-selected="true">Gợi ý phù hợp</a>
                    </div>
                    <p class="m-0 ms-auto d-flex align-items-baseline">
                        <span class="me-2 text-nowrap fw-bold">Lọc theo</span>
                        <select class="form-select" name="" id="">
                            <option value="">Tất cả</option>
                            <option value="">Ngày nộp</option>
                            <option value="">Trạng thái</option>
                        </select>
                    </p>
                </div>
                <div class="w-100 py-3">
                    <div class="rounded-3 vh-100" style="background-color: #fbfbfc;">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="applicant-tab-content" role="tabpanel"
                                aria-labelledby="applicant-tab">
                                <div class="d-flex flex-column gap-3 p-3">
                                    @if (Model?.Applications != null && Model?.Applications.Count > 0)
                                        foreach (var applied in Model!.Applications)
                                        {
                                            <div class="d-flex gap-3 bg-white p-3 rounded-3 shadow-sm">
                                                @{
                                                    var avatarUrl = "../../img/default_user.png";
                                                    if (@applied.Candidate?.AvatarUrl != null)
                                                        avatarUrl = @applied.Candidate?.AvatarUrl;
                                                }
                                                <img src="@avatarUrl" class="flex-shrink-0 rounded-pill" alt=""
                                                    style="width: 50px; height: 50px; object-fit: fill;">
                                                <div class="flex-grow-1 d-flex flex-column">
                                                    <span class="fw-bold">@applied.Candidate!.FullName</span>
                                                    <span class="">@Model.Title</span>
                                                    <span class="fst-italic" style="font-size: .8rem;">Ngày nộp:
                                                        @applied.CreateAt</span>
                                                </div>
                                                <div class="flex-grow-1 align-self-center">
                                                @{
                                                    switch (applied.Status.ToLower())
                                                    {
                                                        case "pending":
                                                            <span class="px-2 py-1 bg-warning rounded-2">@applied.Status.ToUpper()</span>
                                                            break;
                                                        case "viewed":
                                                            <span class="px-2 py-1 bg-info text-white rounded-2">@applied.Status.ToUpper()</span>
                                                            break;
                                                        case "passed":
                                                            <span class="px-2 py-1 bg-success text-white rounded-2">@applied.Status.ToUpper()</span>
                                                            break;
                                                        case "rejected":
                                                            <span class="px-2 py-1 bg-secondary text-white rounded-2">@applied.Status.ToUpper()</span>
                                                            break;
                                                        default:
                                                            <span class="px-2 py-1 bg-danger text-white rounded-2">@applied.Status.ToUpper()</span>
                                                            break;
                                                    }
                                                }
                                                </div>
                                                <div class="d-flex align-items-start gap-2">
                                                    <span data-bs-toggle="tooltip" data-bs-placement="bottom" title="Xem hồ sơ">
                                                        <a class="btn btn-outline-info fs-5 rounded-3 border px-2 py-1 btn-view-profile"
                                                            role="button" data-bs-toggle="modal"
                                                            data-bs-target="#candidate-info-modal"
                                                            data-candidate-id="@applied.CandidateId"><i
                                                                class="fa-solid fa-eye"></i></a>
                                                    </span>
                                                    <span data-bs-toggle="tooltip" data-bs-placement="bottom"
                                                        title="Duyệt hồ sơ">
                                                        <a class="btn btn-outline-primary fs-5 rounded-3 border px-2 py-1 btn-approval"
                                                            role="button" data-candidate-id="@applied.CandidateId"><i
                                                                class="fa-solid fa-circle-check"></i></a>
                                                    </span>
                                                    <span data-bs-toggle="tooltip" data-bs-placement="bottom"
                                                        title="Từ chối hồ sơ">
                                                        <a class="btn btn-outline-danger fs-5 rounded-3 border px-2 py-1 btn-reject-profile"
                                                            role="button" data-candidate-id="@applied.CandidateId"><i
                                                                class="fa-solid fa-circle-xmark"></i></a>
                                                    </span>
                                                </div>
                                            </div>
                                        }
                                </div>
                            </div>
                            <div class="tab-pane fade" id="suggest-tab-content" role="tabpanel"
                                aria-labelledby="suggest-tab">
                                <div class="d-flex flex-column">
                                    <div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="p-3 tab-pane fade" id="job-post-section-content" role="tabpanel" aria-labelledby="job-post-section">
            <div class="row">
                <div class="col-lg-8 tab-content d-lg-block">
                    <div class="bg-light p-4 mb-4 rounded-3">
                        <div class="job-detail__info--title">@Model?.Title</div>
                        <div class="d-flex justify-content-between my-4">
                            <div class="job-detail__info--section d-flex flex-column flex-lg-row">
                                <div class="job-detail__info--section-icon">
                                    <i class="far fa-money-bill-alt"></i>
                                </div>
                                <div class="job-detail__info--section-content">
                                    <div class="job-detail__info--section-content-title">Mức lương</div>
                                    <div class="job-detail__info--section-content-value">@Model?.Salary</div>
                                </div>
                            </div>
                            <div class="job-detail__info--section d-flex flex-column flex-lg-row">
                                <div class="job-detail__info--section-icon">
                                    <i class="fa-solid fa-location-dot"></i>
                                </div>
                                <div class="job-detail__info--section-content">
                                    <div class="job-detail__info--section-content-title">Địa điểm</div>
                                    <div class="job-detail__info--section-content-value">
                                        @Model?.Employer.Company.District.Province.ProvinceName</div>
                                </div>
                            </div>
                            <div class="job-detail__info--section d-flex flex-column flex-lg-row">
                                <div class="job-detail__info--section-icon">
                                    <i class="fa-solid fa-hourglass-half"></i>
                                </div>
                                <div class="job-detail__info--section-content">
                                    <div class="job-detail__info--section-content-title">Hạn cuối</div>
                                    <div class="job-detail__info--section-content-value">
                                        @Model?.ExpiredDate.ToString("dd/MM/yyyy")</div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="bg-light p-4 mb-4 rounded-3">
                        <h5 class="mb-3 fw-bold">Chi tiết tuyển dụng</h5>
                        <div class="d-flex flex-column my-2">
                            <p class="fw-bold fs-6 mb-2">Mô tả công việc</p>
                            <div class="">
                                @Html.Raw(Model?.Description)
                            </div>
                        </div>
                        <div class="d-flex flex-column my-2">
                            <p class="fw-bold fs-6 mb-2">Yêu cầu ứng viên</p>
                            <div class="">
                                @Html.Raw(Model?.Requirement)
                            </div>
                        </div>
                        <div class="d-flex flex-column my-2">
                            <p class="fw-bold fs-6 mb-2">Quyền lợi</p>
                            <div class="">
                                @Html.Raw(Model?.Benefits)
                            </div>
                        </div>
                        <div class="d-flex flex-column my-2">
                            <p class="fw-bold fs-6">Địa điểm làm việc</p>
                            <div class="">
                                Hòa Bình, Bạc Liêu
                            </div>
                        </div>

                        <p>Hạn cuối: 10/11/2023</p>
                    </div>

                </div>
                <div class="col-lg-4">
                    <div class="p-4 mb-4 bg-light rounded-3">
                        <div class="job-detail__company d-flex flex-column gap-3">
                            <div class="d-flex gap-4">
                                <div target="_blank" class="job-detail__company-logo">
                                    <img class="img-responsive" alt="" src="../.@Model?.Employer.Company.LogoUrl">
                                </div>
                                <span target="_blank"
                                    class="job-detail__company-name">@Model?.Employer.Company.CompanyName</span>
                            </div>
                            <div class="d-flex gap-3 align-items-center">
                                <div class="job-detail__company-title flex-shrink-0"><i
                                        class="fa-solid fa-location-dot pe-2 text-primary"></i><span>Địa điểm</span>
                                </div>
                                <div class="job-detail__company-value">
                                    @Model?.Employer.Company.District.Province.ProvinceName</div>
                            </div>
                            <div class="d-flex gap-3 align-items-center">
                                <div class="job-detail__company-title flex-shrink-0"><i
                                        class="fa-solid fa-globe pe-2 text-primary"></i><span>Website</span></div>
                                <div class="job-detail__company-value"><a>@Model?.Employer.Company.WebsiteUrl</a></div>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 mb-4 bg-light rounded-3">
                        <div class="job-detail__company d-flex flex-column gap-3">
                            <h5>Thông tin chung</h5>
                            <div class="d-flex gap-3 align-items-center">
                                <div class="job-detail__info--section-icon text-white">
                                    <i class="fa-solid fa-medal"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <p class="m-0">Cấp bậc</p>
                                    <p class="m-0 fw-bold">@Model?.RequirementSkills.First().Level</p>
                                </div>
                            </div>
                            <div class="d-flex gap-3 align-items-center">
                                <div class="job-detail__info--section-icon text-white">
                                    <i class="fa-solid fa-hourglass-half"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <p class="m-0">Kinh nghiệm</p>
                                    <p class="m-0 fw-bold">@Model?.YearsOfExperience</p>
                                </div>
                            </div>
                            <div class="d-flex gap-3 align-items-center">
                                <div class="job-detail__info--section-icon text-white">
                                    <i class="fa fa-user"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <p class="m-0">Số lượng tuyển</p>
                                    <p class="m-0 fw-bold">@Model?.NumberOfRecruits người</p>
                                </div>
                            </div>
                            <div class="d-flex gap-3 align-items-center">
                                <div class="job-detail__info--section-icon text-white">
                                    <i class="fa-solid fa-briefcase"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <p class="m-0">Hình thức làm việc</p>
                                    <p class="m-0 fw-bold">@Model?.EmploymentType.ToString()</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 mb-4 bg-light rounded-3">
                        <div class="job-detail__company d-flex flex-column gap-3">
                            <h5 class="mb-0">Danh mục</h5>
                            <div class="d-flex mb-3">
                                <a href="" class="text-dark px-2 rounded-pill" target="_blank"
                                    style="background-color: #f1eeee;">@Model.JobType.JobTypeName</a>
                            </div>
                            <h5 class="mb-0">Kỹ năng</h5>
                            <div class="d-flex flex-wrap gap-3">
                                @{
                                    if (Model?.RequirementSkills != null && Model?.RequirementSkills.Count > 0)
                                        foreach (var skill in Model?.RequirementSkills!)
                                        {
                                            <a href="" class="text-dark px-2 rounded-pill" target="_blank"
                                                style="background-color: #f1eeee;">@skill.Skill.SkillName</a>
                                        }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="candidate-info-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Thông tin ứng viên</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex gap-4 py-3">
                    <img class="rounded-3 flex-shrink-0" src="" alt="" style="width: 90px; height: 90px;">
                    <div class="flex-grow-1">
                        <p class="mb-1">Họ tên: <span class="fw-bold">Huỳnh Chí Dũng</span></p>
                        <p class="mb-1">Ứng tuyển vị trí <span class="fw-bold text-primary">Web Developer</span></p>
                        <p class="mb-1">Ngày nộp: <span class="fst-italic">10/11/2023</span></p>
                    </div>
                    <div class="ms-auto btn btn-info text-white align-self-start">
                        <a role="button"><i class="fa-solid fa-file me-2"></i>Xem CV</a>
                    </div>
                </div>
                <div class="list-group list-group-flush">
                    <a class="list-group-item list-group-item-action btn-show-collapse active position-relative"
                        aria-current="true" data-bs-toggle="collapse" role="button" aria-expanded="false"
                        aria-controls="">Kỹ năng <div class=" position-absolute top-50 translate-middle-y"
                            style="right: 15px;"><i class="fa-solid fa-caret-right"></i></div></a>
                    <a class="list-group-item list-group-item-action btn-show-collapse" data-bs-toggle="collapse"
                        role="button" aria-expanded="false" aria-controls="">Kinh nghiệm <div
                            class=" position-absolute top-50 translate-middle-y" style="right: 15px;"><i
                                class="fa-solid fa-caret-right"></i></div></a>
                    <a class="list-group-item list-group-item-action btn-show-collapse" data-bs-toggle="collapse"
                        role="button" aria-expanded="false" aria-controls="">Project <div
                            class=" position-absolute top-50 translate-middle-y" style="right: 15px;"><i
                                class="fa-solid fa-caret-right"></i></div></a>
                    <a class="list-group-item list-group-item-action btn-show-collapse" data-bs-toggle="collapse"
                        role="button" aria-expanded="false" aria-controls="">Học vấn <div
                            class=" position-absolute top-50 translate-middle-y" style="right: 15px;"><i
                                class="fa-solid fa-caret-right"></i></div></a>
                    <a class="list-group-item list-group-item-action btn-show-collapse" data-bs-toggle="collapse"
                        role="button" aria-expanded="false" aria-controls="">Chứng chỉ <div
                            class=" position-absolute top-50 translate-middle-y" style="right: 15px;"><i
                                class="fa-solid fa-caret-right"></i></div></a>
                    <a class="list-group-item list-group-item-action btn-show-collapse" data-bs-toggle="collapse"
                        role="button" aria-expanded="false" aria-controls="">Thư xin việc <div
                            class=" position-absolute top-50 translate-middle-y" style="right: 15px;"><i
                                class="fa-solid fa-caret-right"></i></div></a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {
            const btnChangeSection = $(".btn-change-section");
            const btnShowCollapse = $(".btn-show-collapse");
            btnChangeSection.click(function (e) {
                e.preventDefault();
                $(".btn-change-section").each(function () {
                    $(this).removeClass("active");
                })
                $(this).addClass("active");
            });

            btnShowCollapse.click(function (e) {
                e.preventDefault();
                $(".btn-show-collapse").each(function () {
                    $(this).removeClass("active");
                })
                $(this).addClass("active");
            });

            $(document).on("click", ".btn-view-profile", function () {
                let btnViewProfile = $(this);
                let candidateId = btnViewProfile.data("candidate-id");
            });

            $(document).on("click", ".btn-approval", function () {
                let btnViewProfile = $(this);
                let candidateId = btnViewProfile.data("candidate-id");
            });

            $(document).on("click", ".btn-reject-profile", function () {
                let btnViewProfile = $(this);
                let candidateId = btnViewProfile.data("candidate-id");
            });

            function callAjaxToLoadProfile(candidateId) {
                $.ajax({
                    type: "get",
                    dataType: "json",
                    data: { candidateId: candidateId },
                    url: "",
                    success: function (res) {

                    },
                    error: function (err) {

                    }
                });
            }

            function callAjaxToApproval(candidateId) {
                $.ajax({
                    type: "get",
                    dataType: "json",
                    data: { candidateId: candidateId },
                    url: "",
                    success: function (res) {

                    },
                    error: function (err) {

                    }
                });
            }

            function callAjaxToRejectProfile(candidateId) {
                $.ajax({
                    type: "get",
                    dataType: "json",
                    data: { candidateId: candidateId },
                    url: "",
                    success: function (res) {

                    },
                    error: function (err) {

                    }
                });
            }
        });
    </script>
}