@*
For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="~/css/ChatPage/chat.css">

<div class="container-fluid">
    <div class="row">
        <div class="col-4 col-sm-3 max-vh-100 border-end position-relative">
            <div class="d-flex flex-column overflow-auto p-3 gap-3">
                <div class="d-flex justify-content-between align-items-baseline">
                    <h5 class="d-sm-block d-none">Chat</h5>
                    <a role="button" class="btn btn-square rounded-pill fs-5" style="background-color: #e4e6ed;"
                        data-bs-toggle="collapse" data-bs-target="#find-recipient" aria-expanded="false"
                        aria-controls="find-recipient">
                        <i class="fa-regular fa-pen-to-square"></i>
                    </a>
                    <div class="collapse position-absolute start-100" id="find-recipient">
                        <div class="d-flex flex-column p-3 shadow-sm border-3 rounded-3"
                            style="width: 300px; height: 300px; background-color: #fafafa;">
                            <div class="d-flex align-items-baseline gap-3">
                                <label class="form-label">Đến:</label>
                                <input type="text" class="form-control rounded-pill ">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="position-relative">
                    <input class="form-control rounded-pill ps-5" type="text" id="search-recipient"
                        style="background-color: #e4e6ed;" placeholder="Tìm kiếm người dùng">
                    <span class="position-absolute top-50 translate-middle" style="left: 1.5rem">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </span>
                </div>
                <div class="d-flex flex-column gap-2" id="recipient-container"></div>
            </div>
        </div>
        <div class="col-8 col-sm-9">
            <ul class="list-group list-group-horizontal-xxl overflow-auto my-3 d-flex gap-3" style="height: 75vh;">
                <li class="d-flex gap-2 recipient-message">
                    <img class="btn-square rounded-pill" src="~/img/about-2.jpg" alt="">
                    <div class="d-flex flex-column content-container">
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed ultrices dolor, ac maximus
                            ligula. Donec ex orci, mollis ac purus vel, tempor pulvinar justo. Praesent nibh massa,
                            posuere
                            non mollis vel, molestie non mauris. Aenean consequat facilisis orci, sed sagittis mauris
                            interdum at.
                        </p>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed ultrices dolor, ac maximus
                            ligula. Donec ex orci, mollis ac purus vel, tempor pulvinar justo. Praesent nibh massa,
                            posuere
                            non mollis vel, molestie non mauris. Aenean consequat facilisis orci, sed sagittis mauris
                            interdum at.
                        </p>
                    </div>
                </li>
                <li class="d-flex gap-2 ms-auto sender-message">
                    <div class="d-flex flex-column content-container">
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed ultrices dolor, ac maximus
                            ligula. Donec ex orci, mollis ac purus vel, tempor pulvinar justo. Praesent nibh massa,
                            posuere
                            non mollis vel, molestie non mauris. Aenean consequat facilisis orci, sed sagittis mauris
                            interdum at.
                        </p>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed ultrices dolor, ac maximus
                            ligula. Donec ex orci, mollis ac purus vel, tempor pulvinar justo. Praesent nibh massa,
                            posuere
                            non mollis vel, molestie non mauris. Aenean consequat facilisis orci, sed sagittis mauris
                            interdum at.
                        </p>
                    </div>
                </li>
                <li class="d-flex gap-2 recipient-message">
                    <img class="btn-square rounded-pill" src="~/img/about-2.jpg" alt="">
                    <div class="d-flex flex-column content-container">
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed ultrices dolor, ac maximus
                            ligula. Donec ex orci, mollis ac purus vel, tempor pulvinar justo. Praesent nibh massa,
                            posuere
                            non mollis vel, molestie non mauris. Aenean consequat facilisis orci, sed sagittis mauris
                            interdum at.
                        </p>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed ultrices dolor, ac maximus
                            ligula. Donec ex orci, mollis ac purus vel, tempor pulvinar justo. Praesent nibh massa,
                            posuere
                            non mollis vel, molestie non mauris. Aenean consequat facilisis orci, sed sagittis mauris
                            interdum at.
                        </p>
                    </div>
                </li>
                <li class="d-flex gap-2 ms-auto sender-message">
                    <div class="d-flex flex-column content-container">
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed ultrices dolor, ac maximus
                            ligula. Donec ex orci, mollis ac purus vel, tempor pulvinar justo. Praesent nibh massa,
                            posuere
                            non mollis vel, molestie non mauris. Aenean consequat facilisis orci, sed sagittis mauris
                            interdum at.
                        </p>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed ultrices dolor, ac maximus
                            ligula. Donec ex orci, mollis ac purus vel, tempor pulvinar justo. Praesent nibh massa,
                            posuere
                            non mollis vel, molestie non mauris. Aenean consequat facilisis orci, sed sagittis mauris
                            interdum at.
                        </p>
                    </div>
                </li>
            </ul>
            <div class="d-flex align-items-center gap-3 p-1">
                <span class="fs-5"><i class="fa-solid fa-circle-plus text-secondary"></i></span>
                <span class="fs-5"><i class="fa-regular fa-image text-secondary"></i></span>
                <span class="fs-5"><i class="fa-solid fa-face-smile text-secondary"></i></span>
                <span class="fs-5"><i class="bi bi-filetype-gif text-secondary"></i></span>
                <div class="position-relative w-100 bottom-0">
                    <input type="text" class="form-control rounded-pill" placeholder="Aa">
                    <a role="button" class="position-absolute top-50 translate-middle-y" style="right: 15px;"><i
                            class="bi bi-send-fill text-secondary"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const recipientsContainer = $("#recipient-container");
        const searchRecipient = $("#search-recipient");

        $(document).on('click', ".recipient", function (e) {
            $(".recipient").removeClass("active");
            let recipient = $(this);
            recipient.addClass("active");
            let userId = $(this).data("user-id");
        });

        function loadRecipient() {
            $.ajax({
                type: "Get",
                dataType: "json",
                url: "/Notification/GetAllAppliedEmployers",
                success: function (res) {
                    if (res != null && res.length > 0) {
                        for (let i = 0; i < res.length; i++) {
                            renderRecipientContainer(res[i].jobPost.employer)
                        }
                    }else{
                        renderNoResult()
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function renderRecipientContainer(data) {
            let recipientHtml = `
                <div>
                    <a class="d-flex flex-column py-1 px-2 rounded-3 recipient" data-user-id="${data.userId}">
                        <div class="d-flex align-items-center gap-3">
                            <img class="rounded-pill" src="${'.' + data.company.logoUrl}" alt="" style="width: 55px; height: 55px;">
                            <div class="d-sm-flex flex-column d-none">
                                <span class="fw-bold employer-name">${data.fullName}</span>
                                <span style="font-size: .9rem; color: #888">${'NTD của ' + data.company.companyName}</span>
                            </div>
                        </div>
                    </a>
                </div>`;
            recipientsContainer.append(recipientHtml)
        }

        function renderNoResult() {
            imgHtml = `
                <div class="d-flex flex-column justify-content-center align-items-center">
                    <img src="../img/no-result-found.jpg" alt="" style="width: 200px" />
                    <span class="fw-bold m-1">Bạn chưa ứng tuyển công việc nào</span>
                </div>
            `;
            recipientsContainer.html(imgHtml);
        }

        $(document).ready(function () {
            loadRecipient();

        });
        $(document).on("input", "#search-recipient", function () {
            let value = $(this).val().toLowerCase();
            $(".recipient").each(function () {
                let item = $(this).closest("div");
                let employerName = item.find(".employer-name").text().toLowerCase();
                if (employerName.includes(value)) {
                    item.show();
                } else {
                    item.hide();
                }
            });
        });
    </script>
}